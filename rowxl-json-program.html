<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>RowXL â€” Program Text Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#020617;
      --panel:#0f172a;
      --panel2:#020617;
      --text:#e5f0ff;
      --muted:#9fb5d1;
      --outline:#1e3a5f;
      --brand:#0e3a73;
    }
    *{ box-sizing:border-box }
    body{
      margin:0;
      background:radial-gradient(circle at top,#0b1530 0,#020617 55%,#000 100%);
      color:var(--text);
      font:15px/1.5 system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial;
    }
    .wrap{ max-width:1100px; margin:40px auto; padding:0 20px }
    h1{ font-size:28px; margin:0 0 10px }
    .panel{ background:var(--panel); border:1px solid var(--outline); border-radius:14px; padding:16px }
    .layout{ display:grid; grid-template-columns:1fr 1fr; gap:16px }
    @media (max-width:900px){ .layout{ grid-template-columns:1fr } }
    label{ font-size:12px; color:var(--muted) }
    textarea{
      width:100%; min-height:360px; resize:vertical;
      background:var(--panel2); color:var(--text);
      border:1px solid var(--outline); border-radius:10px;
      padding:10px; font-family:ui-monospace,monospace;
    }
    .btn{ padding:8px 12px; border-radius:999px; border:1px solid var(--outline); cursor:pointer }
    .btn.primary{ background:#2563eb; color:white }
    .btn.ghost{ background:transparent }
    .controls-row{ display:flex; gap:8px; margin-top:8px }
    .tiny{ font-size:12px; color:var(--muted) }
    .toast{ position:fixed; right:12px; bottom:12px; padding:8px 12px; border-radius:999px; background:#0f172a; border:1px solid var(--outline); display:none }
  </style>
</head>
<body>
<div class="wrap">
<h1>RowXL â€” Program Text Generator</h1>
<div class="tiny">Paste JSON â†’ Generate full diary â†’ Copy.</div>

<div class="panel" style="margin-top:16px">
  <div class="layout">
    <div>
      <label>Program JSON</label>
      <textarea id="inputJson"></textarea>
      <div class="controls-row">
        <button id="generateBtn" class="btn primary">Generate Diary</button>
        <button id="clearBtn" class="btn ghost">Clear</button>
      </div>
    </div>
    <div>
      <label>Diary Output</label>
      <textarea id="outputDiary"></textarea>
      <div class="controls-row">
        <button id="copyBtn" class="btn ghost">Copy</button>
      </div>
    </div>
  </div>
</div>
</div>

<div id="toast" class="toast"></div>

<script>
const $ = s => document.querySelector(s)
const toast = m => { const t=$("#toast"); t.textContent=m; t.style.display="block"; setTimeout(()=>t.style.display="none",2500) }

$("#clearBtn").onclick = ()=>{ $("#inputJson").value=""; $("#outputDiary").value="" }
$("#copyBtn").onclick = async()=>{ await navigator.clipboard.writeText($("#outputDiary").value); toast("Copied") }

// ========= SMART NOTE READER =========
function readNotes(note){
  const n = (note||"").toLowerCase()
  return {
    test1k: n.includes("1k"),
    test5k: n.includes("5k"),
    regatta: n.includes("regatta") || n.includes("race") || n.includes("final") || n.includes("championship")
  }
}

// ========= DATE HELPERS =========
const DOW=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]
const parse = d=>new Date(d)
const fmt = d=>d.toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long",year:"numeric"})
const iso = d=>d.toISOString().slice(0,10)

// ========= GENERATOR =========
$("#generateBtn").onclick=()=>{
  let raw
  try{ raw=JSON.parse($("#inputJson").value) }catch{ return toast("Invalid JSON") }

  const name = raw.athlete_name || "Athlete"
  const start = parse(raw.start_date)
  const end = parse(raw.finish_date)
  const weekly = raw.weekly_schedule || {}
  const intent = readNotes(raw.notes)

  let out = `Masters ${raw.gender||""} Training Diary\n`
  out+=`Dates: ${raw.start_date} â†’ ${raw.finish_date}\n`
  out+=`Intensity: ~${raw.intensity_percent||75}%\n\n------------------------------------------------------------\n\n`

  const cur=new Date(start)
  while(cur<=end){
    const day=DOW[cur.getDay()]
    let sess=weekly[day]||"Rest"
    const label=`ðŸ—“ï¸ ${fmt(cur)} â€” ${sess}`
    const last=iso(cur)===iso(end)

    out+=label+"\n\n"

    if(intent.regatta && last){
      out+=`Warm-up:\n15 min progressive paddle\n\nMain Set:\nRACE DAY / REGATTA\n\nFocus:\nExecute your race plan. Row with confidence.\n\nNotes:\nFull recovery after racing.\n\n`
    }
    else if(intent.test1k && last && /erg/i.test(sess)){
      out+=`Warm-up:\n10 min + 3 short bursts\n\nMain Set:\n1 Ã— 1,000 m TEST\n\nFocus:\nRace execution and pacing.\n\nNotes:\nRecord result.\n\n`
    }
    else if(intent.test5k && last && /erg/i.test(sess)){
      out+=`Warm-up:\n10 min smooth\n\nMain Set:\n1 Ã— 5,000 m TEST\n\nFocus:\nConsistency under fatigue.\n\nNotes:\nRecord average split.\n\n`
    }
    else if(/water/i.test(sess)){
      out+=`Steady technical water session focused on timing and balance.\n\n`
    }
    else if(/weight/i.test(sess)){
      out+=`Strength and robustness session.\n\n`
    }
    else if(/erg/i.test(sess)){
      out+=`Aerobic / threshold erg session.\n\n`
    }
    else{
      out+=`Rest and recovery.\n\n`
    }

    out+=`Athlete Notes:\n________________________\n\n------------------------------------------------------------\n\n`
    cur.setDate(cur.getDate()+1)
  }

  // ========= END SUMMARY =========
  out+=`\nPROGRAM SUMMARY\n\n`
  out+=`This training block focused on building aerobic efficiency and technical consistency.\n`

  if(intent.test1k) out+=`The program concluded with a 1k test to assess race fitness.\n`
  if(intent.test5k) out+=`The block ended with a 5k test to benchmark endurance.\n`
  if(intent.regatta) out+=`The program tapered into a regatta / race scenario.\n`

  out+=`Next step: review performance and adjust future training accordingly.\n`
  out+=`\nâ€œConsistency builds champions.â€\n`

  $("#outputDiary").value=out
  toast("Diary generated")
}
</script>
</body>
</html>
