<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>RowXL ‚Äî Program Text Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0a1a2f; --panel:#0f2747; --panel2:#113057; --text:#e9f0fb;
      --muted:#9fb5d1; --outline:#1e3a5f; --brand:#0e3a73;
    }
    *{ box-sizing:border-box }
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font:15px/1.5 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
    }
    .wrap{ max-width:1100px; margin:40px auto; padding:0 20px }
    h1{ margin:0 0 18px; font-size:26px }

    .panel{
      background:var(--panel);
      border:1px solid var(--outline);
      border-radius:10px;
      padding:16px;
    }

    label{ font-size:12px; color:var(--muted); margin-bottom:4px; display:block }

    textarea,input,button{
      background:var(--panel2);
      color:var(--text);
      border:1px solid var(--outline);
      border-radius:8px;
      padding:8px 10px;
      outline:none;
      font-family:inherit;
    }
    textarea::placeholder,input::placeholder{ color:#7fa1cc }
    textarea{
      width:100%;
      min-height:260px;
      resize:vertical;
      font-family:Menlo,Consolas,monospace;
      font-size:13px;
      white-space:pre;
      overflow:auto;
    }
    button{
      cursor:pointer;
      border-radius:8px;
      margin-right:6px;
      margin-top:6px;
      font-size:13px;
    }
    .btn-primary{ background:var(--brand); border-color:#205b9a }
    .btn-ghost{ background:transparent }
    .tiny{ font-size:12px; color:var(--muted); }

    .cols{
      display:flex;
      gap:14px;
      flex-wrap:wrap;
    }
    .col{
      flex:1 1 320px;
      min-width:0;
    }

    .toast{
      position:fixed;
      right:14px;
      bottom:14px;
      background:#113057;
      border:1px solid var(--outline);
      padding:8px 10px;
      border-radius:10px;
      font-size:13px;
      display:none;
      z-index:20;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>RowXL ‚Äî Program Text Generator</h1>
    <p class="tiny">
      Paste your program JSON on the left and click <strong>Generate diary</strong>.  
      The right side will give you a full day-by-day training diary you can copy anywhere.
    </p>

    <div class="panel">
      <div class="cols">
        <!-- JSON INPUT -->
        <div class="col">
          <label for="programJson">Program JSON</label>
          <textarea id="programJson" spellcheck="false" placeholder="Paste your JSON here..."></textarea>
          <button class="btn-ghost" id="loadSampleBtn">Load sample JSON</button>
          <button class="btn-primary" id="generateBtn">Generate diary</button>
        </div>

        <!-- OUTPUT -->
        <div class="col">
          <label for="programOutput">Generated Training Diary (copy &amp; paste)</label>
          <textarea id="programOutput" readonly placeholder="Your program diary will appear here..."></textarea>
          <button class="btn-ghost" id="copyBtn">Copy diary</button>
          <button class="btn-ghost" id="clearBtn">Clear</button>
          <p class="tiny">
            Every day will include: Warm-up, Main Set, Stroke Rate/HR zone (where relevant),
            Technical Focus, Notes, and an Athlete Notes section.
          </p>
        </div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    const DAY_NAMES = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];

    const SAMPLE_JSON = `{
  "athlete": {
    "name": "Jane Doe",
    "gender": "Female",
    "category": "Masters"
  },
  "program": {
    "start_date": "2025-11-26",
    "end_date": "2025-12-26",
    "intensity_percent": 75,
    "focus": "Aerobic base and technical consistency",
    "weekly_schedule": {
      "Mon": "Erg (UT2)",
      "Tue": "Weights",
      "Wed": "Rest",
      "Thu": "Water Row",
      "Fri": "Water Row",
      "Sat": "Weights",
      "Sun": "Rest"
    }
  }
}`;

    const $ = id => document.getElementById(id);
    const toastEl = $("toast");
    function showToast(msg){
      toastEl.textContent = msg;
      toastEl.style.display = "block";
      clearTimeout(showToast._h);
      showToast._h = setTimeout(()=>toastEl.style.display="none",2000);
    }

    function formatLongDate(d){
      return d.toLocaleDateString(undefined,{
        weekday:"long",
        year:"numeric",
        month:"long",
        day:"numeric"
      });
    }

    function buildSessionBlock(date, type, cfg){
      const titleDate = formatLongDate(date);
      const intensity = cfg.program.intensity_percent ?? 75;

      let out = `üóìÔ∏è ${titleDate} ‚Äî ${type}\n\n`;

      const lower = type.toLowerCase();

      if (lower.includes("rest")) {
        out +=
`Warm-up:
None planned.

Main Set:
Rest day.

Focus:
Recovery, sleep and general mobility.

Notes:
Light walking or gentle stretching is encouraged, but no structured training is required.

Athlete Notes:
_________________________________________________

`;
        return out;
      }

      if (lower.includes("erg")) {
        out +=
`Warm-up:
10 minutes very easy rowing, gradually building from light paddling to a steady UT2 rhythm.

Main Set:
2 √ó 40 minutes continuous UT2 rowing.
Stroke Rate: 18‚Äì20 spm
Heart Rate: 60‚Äì70% HR max (easy conversational effort).
Rest: 3 minutes very light paddling between pieces.

Technical Focus:
‚Ä¢ Long, relaxed stroke with quiet shoulders.
‚Ä¢ Strong connection through the legs before the body and arms.
‚Ä¢ Smooth, unhurried recovery with balanced posture on the slide.

Focus:
Aerobic conditioning and rhythm at approximately ${intensity}% effort, without chasing split.

Notes:
You should always feel that you could continue another 10‚Äì15 minutes at the end of each piece.

Athlete Notes:
_________________________________________________

`;
        return out;
      }

      if (lower.includes("weight")) {
        out +=
`Warm-up:
5‚Äì8 minutes light cardio (row, cycle or treadmill) plus dynamic mobility for hips, hamstrings, shoulders and back.

Main Set:
Block A
‚Ä¢ Goblet Squat ‚Äì 3 √ó 10
‚Ä¢ Romanian Deadlift ‚Äì 3 √ó 8

Block B
‚Ä¢ Lat Pulldown or Assisted Pull-down ‚Äì 3 √ó 10
‚Ä¢ Dumbbell Bench Press ‚Äì 3 √ó 8

Block C
‚Ä¢ Seated or Cable Row ‚Äì 3 √ó 10
‚Ä¢ Front Plank ‚Äì 3 √ó 30‚Äì40 seconds

Rest:
60‚Äì90 seconds between working sets.

Technical Focus:
‚Ä¢ Neutral spine at all times (no rounding).
‚Ä¢ Drive from the legs and hips rather than the lower back.
‚Ä¢ Smooth, controlled lowering phase; strong but not jerky on the way up.

Focus:
Maintain rowing-specific strength and robustness without creating heavy fatigue.

Notes:
Choose loads that feel ‚Äúcomfortably hard‚Äù on the last 2 reps but always leave 1‚Äì2 good reps in reserve.

Athlete Notes:
_________________________________________________

`;
        return out;
      }

      if (lower.includes("water")) {
        out +=
`Warm-up:
10‚Äì15 minutes light paddling, building gradually from very easy to steady rowing.
Include 3 √ó 10 stroke builds up to 22‚Äì24 spm with plenty of paddling between.

Main Set:
Option A ‚Äì continuous:
‚Ä¢ 40‚Äì50 minutes steady rowing.

Option B ‚Äì broken:
‚Ä¢ 2 √ó 20‚Äì25 minutes with 3 minutes light paddling between pieces.
Stroke Rate: 18‚Äì22 spm
Heart Rate: UT2 to light UT1 (roughly 60‚Äì75% HR max).

Technical Focus:
‚Ä¢ Clean, quiet catches with the blade fully loaded before the drive.
‚Ä¢ Strong leg drive while the upper body stays relaxed and supported.
‚Ä¢ Level hands at the finish and tidy, consistent tap-down.

Focus:
Boat run, timing and aerobic efficiency with no rush on the slide.

Notes:
If conditions are poor, shorten the main set slightly but keep it controlled and safe. Prioritise timing and balance over power.

Athlete Notes:
_________________________________________________

`;
        return out;
      }

      // generic fallback (if type is something unusual)
      out +=
`Warm-up:
10 minutes easy movement suitable for this session.

Main Set:
Work as appropriate for: ${type}.

Focus:
Controlled, smooth effort at roughly ${intensity}% intensity.

Notes:
Move well, avoid rushing, and prioritise good mechanics over intensity.

Athlete Notes:
_________________________________________________

`;
      return out;
    }

    function buildDiary(cfg){
      if (!cfg.program || !cfg.program.start_date || !cfg.program.end_date) {
        throw new Error("program.start_date and program.end_date are required.");
      }
      const start = new Date(cfg.program.start_date + "T00:00:00");
      const end   = new Date(cfg.program.end_date   + "T00:00:00");
      if (isNaN(start) || isNaN(end)) throw new Error("Dates must be valid YYYY-MM-DD values.");
      if (end < start) throw new Error("end_date must be on or after start_date.");

      const sched = cfg.program.weekly_schedule || {};
      const intensity = cfg.program.intensity_percent ?? 75;
      const focus = cfg.program.focus || "Aerobic base and strength maintenance";
      const athlete = cfg.athlete || {};

      // Header
      let out = "";
      const headerMonth = start.toLocaleDateString(undefined,{month:"long",year:"numeric"});
      out += `Masters ${athlete.gender || "Athlete"} ‚Äì ${headerMonth} Training Diary\n`;
      out += `Dates: ${cfg.program.start_date} ‚Üí ${cfg.program.end_date}\n`;
      out += `Category: ${athlete.category || "Masters"}\n`;
      out += `Intensity Level: ~${intensity}%\n`;
      out += `Primary Focus: ${focus}\n\n`;
      out += `Weekly Structure:\n`;
      out += `Mon ${sched.Mon || "‚Äî"}\n`;
      out += `Tue ${sched.Tue || "‚Äî"}\n`;
      out += `Wed ${sched.Wed || "‚Äî"}\n`;
      out += `Thu ${sched.Thu || "‚Äî"}\n`;
      out += `Fri ${sched.Fri || "‚Äî"}\n`;
      out += `Sat ${sched.Sat || "‚Äî"}\n`;
      out += `Sun ${sched.Sun || "‚Äî"}\n\n`;
      out += `Quote:\n‚ÄúConsistency builds champions.‚Äù\n\n`;
      out += `------------------------------------------------------------\n\n`;

      // Day-by-day
      const d = new Date(start);
      while (d <= end) {
        const key = DAY_NAMES[d.getDay()];
        const type = sched[key] || "Rest";
        out += buildSessionBlock(d, type, cfg);
        out += "------------------------------------------------------------\n\n";
        d.setDate(d.getDate() + 1);
      }
      return out.trim();
    }

    // Wire buttons
    $("loadSampleBtn").addEventListener("click", () => {
      $("programJson").value = SAMPLE_JSON;
      showToast("Sample JSON loaded");
    });

    $("generateBtn").addEventListener("click", () => {
      const raw = $("programJson").value.trim();
      if (!raw) { showToast("Paste your JSON first."); return; }
      let cfg;
      try {
        cfg = JSON.parse(raw);
      } catch (e) {
        showToast("JSON is not valid. Check commas and quotes.");
        return;
      }
      try{
        const diary = buildDiary(cfg);
        $("programOutput").value = diary;
        showToast("Diary generated");
      } catch (e){
        showToast(e.message || "Error generating diary");
      }
    });

    $("copyBtn").addEventListener("click", () => {
      const txt = $("programOutput").value;
      if (!txt.trim()) { showToast("Nothing to copy yet."); return; }
      navigator.clipboard.writeText(txt).then(
        ()=>showToast("Diary copied"),
        ()=>showToast("Copy blocked by browser")
      );
    });

    $("clearBtn").addEventListener("click", () => {
      $("programOutput").value = "";
    });

    // preload sample for convenience
    $("programJson").value = SAMPLE_JSON;
  </script>
</body>
</html>
